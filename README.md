# BestNox

客先常駐や、フリーランスでの自社業務を想定したWebサイトです。
主な機能としては以下となります。

- アカウント登録
  メールやSNS認証は実装していません。
- ログイン
- 業務日報
  作成者以外の閲覧権限は未実装です。
- オンラインメモ（課題表やTodoリストなど）

デモサイトは[こちら](https://ginpaydo.work/demo/bestnox/)です。  
*BestNoxは架空の会社です。  
書いてあることは出鱈目なので真に受けないでください。*  
※トップページや各フッターに未実装のボタンやリンクがありますが、ミスではありません。  
※ログインした後の画面の見た目は結構酷いです。  
![BestNox BestNox](https://user-images.githubusercontent.com/39305262/60418546-2843e180-9c1e-11e9-8681-246baa27d2d5.png)

## はじめに
開発や検証ができるまでの手順を説明します。
### 前提条件
ASP.NET Core2.2製です。
フロントエンドはBootstrap4です。フロントエンドフレームワークは現在の所導入していません。
開発とテスト環境はWindows10、VisualStudio2019です。
DBはMariaDB10.3で動作を確認しています。
インストール作業を行う前に、MariaDBをセットアップしてユーザ作成まで完了した状態にします。

### インストール方法
プロジェクトごとチェックアウトを行います。
マイグレーション機能が必要なので、VisualStudio2017以降を使用します。

#### ファイルの編集
以下のファイルを編集します。

##### appsettings.json
本番系の環境に合わせて、ポート番号を指定します。  
分からない場合は取り敢えず5000にしてください。  
必ず他のシステムやアプリケーションと異なる番号を指定してください。

##### appsettings.Development.json
データベースの環境（検証系）に合わせて変更します。

##### appsettings.Production.json
データベースの環境（本番系）に合わせて変更します。パスワードはここには書きません。

##### appsettings.Demo.json
デモサイトを配置する場合はこのファイルも本番系と同様に変更します。  
データベース名だけは同じにしないでください。

#### マイグレーション
変更を行ったら、マイグレーション機能でデータベースにテーブルを作成します。
パッケージマネージャコンソールに以下を入力します。

```
> Update-Database
```

![マイグレーションによるテーブル作成](https://user-images.githubusercontent.com/39305262/56457865-bf3d2380-63bb-11e9-855b-e5fe094ecd2a.png "マイグレーションによるテーブル作成")

#### 管理者アカウントの作成
Areas/Identity/Pages/Account/Register.cshtml

このソースにコメントアウトがあるので、これを解除します。（設定ファイルで切り替えできるようにすべきですね）
実際にVS2017でビルドを行い、デバッグなしで実行を行います。
（ローカル環境からDBサーバに接続できる状態でない場合は、実際に動かすサーバにデプロイします）
Webサイトがブラウザに表示されますので、アカウントの作成を行います。
この時、管理者権限付与にチェックを入れてください。このアカウントに管理者権限が付与されます。
パスワードは大文字小文字を混合させ、記号を1字以上入れてください。
アカウント名は英数字のみ使用可能です。

**アカウントの作成が終わったら再びコメントアウトしてください**

#### パラメータ設定
管理者アカウントでログインすると「システムパラメータ設定」画面を表示できます。
この画面を表示することで、初期値が設定されます。
これを行うまでは他の画面にアクセスしないでください。

デモサイトの場合は、「1のときゲスト投稿をロックする」の値を"1"にすることで、記事の投稿や編集をロックできます。

### 使用方法
適当に使います。

## テストの実行
テストは作成していません。

## デプロイ
VisualStudioの発行機能を使用して、通常通り発行を行ってください。
大まかな手順は公式のプロジェクトと同様にデプロイできますが、数点手を加える必要があります。
・デプロイ先の環境変数に”BESTNOX_DATABASE_PASSWORD”を設定し、本番系DBのパスワードを設定してください。Apache,　Nginxなどのプロキシ機能を使用する場合、こちらに環境変数を設定します。
・nlog.configの設定を本番環境に合わせて変更するか、nlog_Production.configをnlog.configに差し替えます。nlog_Production.configはLinux環境向けに記述しています。

## 協働するシステムのリスト
- NLog
- NginxまたはApacheなどのサーバソフト

## コントリビューション
私たちのコーディング規範とプルリクエストの手順などは特に考えていません。

## バージョン管理
私たちはバージョン管理方法を特に設けていません。

## 著者
- **Ginpaydo** - *原著者* - [Ginpaydo](https://github.com/ginpaydo)  
このプロジェクトへの[貢献者](https://github.com/ginpaydo/project/contributors)のリストもご覧ください。

## ライセンス
このプロジェクトは MIT ライセンスの元にライセンスされています。 詳細は[LICENSE.md](LICENSE.md)をご覧ください。

## 謝辞
- 私を酷使することでこのようなサイトを考案するきっかけを作ってくださったSESの某社に感謝致します。
